@page "/evaluate"
@using BlazorMLDashboard
@using static TelerikBlazorMLDashboard.Components.Pages.EvaluationView.TaxiFormModel
@inject MLModel model

<h3>Evaluate</h3>
<TelerikForm Model="@FormModel"
             OnValidSubmit="@HandleValidSubmit">
    <FormValidation>
        <DataAnnotationsValidator />
    </FormValidation>
    <FormItems>
        <FormItem>
            <Template>
                <label for="ratecode" class="k-label k-form-label">Rate Code</label>
                <TelerikDropDownList Id="ratecode"
                                     Data="@FormModel.RateCodeOptions"
                                     @bind-Value="@FormModel.SelectedRateCode"
                                     TextField="@nameof(RateCodeOption.Name)"
                                     ValueField="@nameof(RateCodeOption.Value)"
                                     Width="100%">
                </TelerikDropDownList>
            </Template>
        </FormItem>
        <FormAutoGeneratedItems />
        <FormItem>
            <Template>
                <label for="vendor" class="k-label k-form-label">Vendor</label>
                <TelerikDropDownList Id="vendor"
                                     Data="@FormModel.VendorOptions"
                                     @bind-Value="@FormModel.SelectedVendorOption"
                                     TextField="@nameof(VendorOption.Name)"
                                     ValueField="@nameof(VendorOption.Value)"
                                     DefaultText="Select a vendor..."
                                     Width="100%">
                </TelerikDropDownList>
            </Template>
        </FormItem>
        <FormItem>
            <Template>
                <label for="payment" class="k-label k-form-label">Payment</label>
                <TelerikDropDownList Id="payment"
                                     Data="@FormModel.PaymentOptions"
                                     @bind-Value="@FormModel.SelectedPayment"
                                     TextField="@nameof(PaymentOption.Name)"
                                     ValueField="@nameof(PaymentOption.Value)"
                                     DefaultText="Select a payment..."
                                     Width="100%">
                </TelerikDropDownList>
            </Template>
        </FormItem>
    </FormItems>
</TelerikForm>
<p>Predicted Fare: @($"{estimatedFare:c}")</p>

@code {
    TaxiFormModel FormModel = new();
    double? estimatedFare;
    void HandleValidSubmit()
    {
        estimatedFare = model.Predict(FormModel.ToTripModelInput()).Score;
    }
}
